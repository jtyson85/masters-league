<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Master's League</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>body { background: #0f172a; }</style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;
    const CONFIG = { regularSeasonWeeks: 13 };

    function calculateStandings(teams, weeklyData, schedule) {
      const standings = {};
      teams.forEach(t => {
        standings[t.id] = { ...t, totalVP: 0, h2hVP: 0, ptsVP: 0, totalPts: 0, wins: 0, losses: 0, ties: 0, weeklyResults: [] };
      });
      weeklyData.forEach(week => {
        const scores = week.scores;
        const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
        const processMatchup = (home, away) => {
          const hs = scores[home] || scores[String(home)];
          const as = scores[away] || scores[String(away)];
          if (hs > as) { standings[home].h2hVP += 2; standings[home].wins += 1; standings[away].losses += 1; }
          else if (as > hs) { standings[away].h2hVP += 2; standings[away].wins += 1; standings[home].losses += 1; }
          else { standings[home].h2hVP += 1; standings[away].h2hVP += 1; standings[home].ties += 1; standings[away].ties += 1; }
        };
        week.espnMatchups.forEach(([h, a]) => processMatchup(h, a));
        const weekSchedule = schedule[String(week.week)];
        if (weekSchedule) weekSchedule.forEach(([h, a]) => processMatchup(h, a));
        sorted.forEach(([id], rank) => {
          const tid = parseInt(id);
          if (rank < 3) standings[tid].ptsVP += 2;
          else if (rank < 6) standings[tid].ptsVP += 1;
        });
        Object.keys(standings).forEach(id => {
          const tid = parseInt(id);
          const score = scores[tid] || scores[String(tid)] || 0;
          standings[tid].totalPts += score;
          const rank = sorted.findIndex(([sid]) => parseInt(sid) === tid) + 1;
          standings[tid].weeklyResults.push({ week: week.week, score, rank });
        });
      });
      Object.values(standings).forEach(t => { t.totalVP = t.h2hVP + t.ptsVP; });
      return Object.values(standings).sort((a, b) => b.totalVP - a.totalVP || b.totalPts - a.totalPts);
    }

    function calculateProjections(standings, weeksPlayed, totalWeeks) {
      const weeksLeft = totalWeeks - weeksPlayed;
      const maxVPPerWeek = 6;
      return standings.map((team, idx) => {
        const maxPossible = team.totalVP + (weeksLeft * maxVPPerWeek);
        let status = "";
        if (idx < 4) status = weeksLeft === 0 ? "Clinched Playoff" : "Playoff Position";
        else if (idx < 6) status = "Bubble";
        else status = weeksLeft === 0 ? "Eliminated" : "Outside Looking In";
        return { ...team, maxPossible, status, seed: idx + 1 };
      });
    }

    // Shared PlayerRoster component
    function PlayerRoster({ players, teamName, isWinner }) {
      if (!players || players.length === 0) {
        return (
          <div className="text-center text-slate-500 py-4 text-sm">
            Player data not available
          </div>
        );
      }
      
      const starters = players.filter(p => p.isStarter);
      const bench = players.filter(p => !p.isStarter);
      const starterTotal = starters.reduce((sum, p) => sum + p.points, 0);
      
      return (
        <div className="space-y-2">
          <div className="flex items-center justify-between mb-2">
            <span className={`font-medium ${isWinner ? 'text-emerald-400' : 'text-white'}`}>{teamName}</span>
            <span className={`text-lg font-bold ${isWinner ? 'text-emerald-400' : 'text-white'}`}>{starterTotal.toFixed(1)}</span>
          </div>
          
          <div className="space-y-1">
            {starters.map((player, i) => (
              <div key={i} className="flex items-center justify-between text-sm py-1 border-b border-slate-700/50">
                <div className="flex items-center gap-2">
                  <span className="text-xs text-slate-500 w-8">{player.position}</span>
                  <span className="text-slate-200">{player.name}</span>
                </div>
                <span className={`font-medium ${player.points >= 20 ? 'text-emerald-400' : player.points >= 10 ? 'text-white' : player.points > 0 ? 'text-slate-400' : 'text-red-400'}`}>
                  {player.points.toFixed(1)}
                </span>
              </div>
            ))}
          </div>
          
          {bench.length > 0 && (
            <details className="mt-2">
              <summary className="text-xs text-slate-500 cursor-pointer hover:text-slate-400">
                Bench ({bench.length} players)
              </summary>
              <div className="mt-1 space-y-1 pl-2 border-l border-slate-700">
                {bench.map((player, i) => (
                  <div key={i} className="flex items-center justify-between text-xs py-1 text-slate-500">
                    <div className="flex items-center gap-2">
                      <span className="w-8">{player.position}</span>
                      <span>{player.name}</span>
                    </div>
                    <span>{player.points.toFixed(1)}</span>
                  </div>
                ))}
              </div>
            </details>
          )}
        </div>
      );
    }

    function Standings({ projections }) {
      return (
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead><tr className="border-b border-slate-700 text-slate-400">
              <th className="text-left py-3 px-2">Seed</th><th className="text-left py-3 px-2">Team</th><th className="text-center py-3 px-2">VP</th>
              <th className="text-center py-3 px-2 hidden sm:table-cell">H2H</th><th className="text-center py-3 px-2 hidden sm:table-cell">Pts</th>
              <th className="text-center py-3 px-2 hidden md:table-cell">Record</th><th className="text-right py-3 px-2">Total Pts</th>
              <th className="text-center py-3 px-2 hidden lg:table-cell">Status</th>
            </tr></thead>
            <tbody>
              {projections.map((team, i) => (
                <tr key={team.id} className={`border-b border-slate-800 hover:bg-slate-800/50 ${i < 4 ? 'bg-emerald-500/5' : i < 6 ? 'bg-yellow-500/5' : ''}`}>
                  <td className="py-3 px-2"><span className={`inline-flex items-center justify-center w-7 h-7 rounded-full text-xs font-bold ${i < 4 ? 'bg-emerald-500/20 text-emerald-400' : i < 6 ? 'bg-yellow-500/20 text-yellow-400' : 'bg-slate-700 text-slate-400'}`}>{i + 1}</span></td>
                  <td className="py-3 px-2"><div className="font-medium text-white">{team.name}</div><div className="text-xs text-slate-500">{team.owner}</div></td>
                  <td className="text-center py-3 px-2"><span className="text-lg font-bold text-white">{team.totalVP}</span></td>
                  <td className="text-center py-3 px-2 text-slate-300 hidden sm:table-cell">{team.h2hVP}</td>
                  <td className="text-center py-3 px-2 text-slate-300 hidden sm:table-cell">{team.ptsVP}</td>
                  <td className="text-center py-3 px-2 text-slate-300 hidden md:table-cell">{team.wins}-{team.losses}{team.ties > 0 ? `-${team.ties}` : ''}</td>
                  <td className="text-right py-3 px-2 text-slate-300">{team.totalPts.toFixed(1)}</td>
                  <td className="text-center py-3 px-2 hidden lg:table-cell">
                    <span className={`text-xs px-2 py-1 rounded-full ${team.status.includes('Clinched') || team.status.includes('Playoff') ? 'bg-emerald-500/20 text-emerald-400' : team.status === 'Eliminated' ? 'bg-red-500/20 text-red-400' : 'bg-slate-700 text-slate-400'}`}>{team.status}</span>
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
          <div className="mt-6 p-4 bg-slate-800/50 rounded-lg border border-slate-700">
            <h4 className="text-sm font-medium text-slate-300 mb-2">Victory Points Scoring</h4>
            <div className="grid grid-cols-2 gap-4 text-xs text-slate-400">
              <div><div className="font-medium text-slate-300 mb-1">Head-to-Head (2 matchups/week)</div><div>Win: 2 VP ‚Ä¢ Tie: 1 VP ‚Ä¢ Loss: 0 VP</div></div>
              <div><div className="font-medium text-slate-300 mb-1">Weekly Points Ranking</div><div>1st-3rd: 2 VP ‚Ä¢ 4th-6th: 1 VP ‚Ä¢ 7th-10th: 0 VP</div></div>
            </div>
          </div>
          <div className="grid grid-cols-2 gap-2 text-xs mt-4">
            <div className="flex items-center gap-2 text-slate-400"><div className="w-3 h-3 rounded-full bg-emerald-500/30"></div> Championship Bracket (1-4)</div>
            <div className="flex items-center gap-2 text-slate-400"><div className="w-3 h-3 rounded-full bg-yellow-500/30"></div> Consolation Bracket (5-6 bye)</div>
          </div>
        </div>
      );
    }

    function WeeklyView({ data, standings, selectedWeek, setSelectedWeek }) {
      const [expandedMatchup, setExpandedMatchup] = useState(null);
      const weeks = data.weeks.map(w => w.week);
      const weekData = data.weeks.find(w => w.week === selectedWeek);
      
      if (!weekData) return <div className="text-slate-400 text-center py-8">No data for Week {selectedWeek}</div>;
      
      const scores = weekData.scores;
      const rosters = weekData.rosters || {};
      const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
      
      const allMatchups = [];
      weekData.espnMatchups.forEach(([h, a]) => {
        const hs = scores[h] || scores[String(h)]; 
        const as = scores[a] || scores[String(a)];
        allMatchups.push({ 
          home: h, away: a, homeScore: hs, awayScore: as, source: 'ESPN',
          homeRoster: rosters[String(h)]?.players || null,
          awayRoster: rosters[String(a)]?.players || null
        });
      });
      const weekSchedule = data.schedule[String(selectedWeek)];
      if (weekSchedule) {
        weekSchedule.forEach(([h, a]) => {
          const hs = scores[h] || scores[String(h)]; 
          const as = scores[a] || scores[String(a)];
          allMatchups.push({ 
            home: h, away: a, homeScore: hs, awayScore: as, source: 'Schedule',
            homeRoster: rosters[String(h)]?.players || null,
            awayRoster: rosters[String(a)]?.players || null
          });
        });
      }

      // Reset expanded matchup when week changes
      useEffect(() => {
        setExpandedMatchup(null);
      }, [selectedWeek]);

      return (
        <div className="space-y-4">
          <div className="flex gap-2 overflow-x-auto pb-2">
            {weeks.map(w => (
              <button 
                key={w} 
                onClick={() => setSelectedWeek(w)} 
                className={`px-4 py-2 rounded-lg text-sm font-medium whitespace-nowrap ${selectedWeek === w ? 'bg-blue-600 text-white' : 'bg-slate-800 text-slate-400 hover:bg-slate-700'}`}
              >
                Wk {w}
              </button>
            ))}
          </div>
          <div className="grid md:grid-cols-2 gap-4">
            <div>
              <h4 className="text-sm font-medium text-slate-400 mb-3">Matchups (2 VP per win)</h4>
              <div className="grid gap-2">
                {allMatchups.map((m, i) => {
                  const home = data.teams.find(t => t.id === m.home); 
                  const away = data.teams.find(t => t.id === m.away);
                  const homeWon = m.homeScore > m.awayScore; 
                  const awayWon = m.awayScore > m.homeScore; 
                  const isTie = m.homeScore === m.awayScore;
                  const matchupKey = `${m.source}-${m.home}-${m.away}`;
                  const isExpanded = expandedMatchup === matchupKey;
                  const hasRosterData = m.homeRoster || m.awayRoster;
                  
                  return (
                    <div key={i} className={`bg-slate-800/50 rounded-lg border ${m.source === 'ESPN' ? 'border-blue-500/30' : 'border-purple-500/30'} overflow-hidden`}>
                      <div 
                        className={`p-3 ${hasRosterData ? 'cursor-pointer hover:bg-slate-700/30' : ''}`}
                        onClick={() => hasRosterData && setExpandedMatchup(isExpanded ? null : matchupKey)}
                      >
                        <div className="flex items-center justify-between mb-2">
                          <span className={`text-xs px-2 py-0.5 rounded ${m.source === 'ESPN' ? 'bg-blue-500/20 text-blue-400' : 'bg-purple-500/20 text-purple-400'}`}>{m.source}</span>
                          {hasRosterData && (
                            <span className="text-xs text-slate-500">
                              {isExpanded ? '‚ñº' : '‚ñ∂'} Players
                            </span>
                          )}
                        </div>
                        <div className={`flex justify-between ${homeWon ? 'text-emerald-400' : isTie ? 'text-yellow-400' : 'text-slate-300'}`}>
                          <span>{home?.abbrev}</span>
                          <div className="flex items-center gap-2">
                            <span className="font-bold">{m.homeScore?.toFixed(1)}</span>
                            {homeWon && <span className="text-xs">+2 VP</span>}
                            {isTie && <span className="text-xs">+1 VP</span>}
                          </div>
                        </div>
                        <div className={`flex justify-between ${awayWon ? 'text-emerald-400' : isTie ? 'text-yellow-400' : 'text-slate-300'}`}>
                          <span>{away?.abbrev}</span>
                          <div className="flex items-center gap-2">
                            <span className="font-bold">{m.awayScore?.toFixed(1)}</span>
                            {awayWon && <span className="text-xs">+2 VP</span>}
                            {isTie && <span className="text-xs">+1 VP</span>}
                          </div>
                        </div>
                      </div>
                      
                      {isExpanded && hasRosterData && (
                        <div className="border-t border-slate-700 p-3 bg-slate-950/50">
                          <div className="grid gap-4">
                            <PlayerRoster 
                              players={m.homeRoster} 
                              teamName={home?.name}
                              isWinner={homeWon}
                            />
                            <div className="border-t border-slate-700 pt-3">
                              <PlayerRoster 
                                players={m.awayRoster} 
                                teamName={away?.name}
                                isWinner={awayWon}
                              />
                            </div>
                          </div>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
            </div>
            <div>
              <h4 className="text-sm font-medium text-slate-400 mb-3">Points Ranking</h4>
              <div className="bg-slate-800/50 rounded-lg p-3 border border-slate-700">
                {sorted.map(([id, score], i) => {
                  const team = data.teams.find(t => t.id === parseInt(id)); 
                  const vpEarned = i < 3 ? 2 : i < 6 ? 1 : 0;
                  return (
                    <div key={id} className={`flex items-center justify-between py-2 ${i < sorted.length - 1 ? 'border-b border-slate-700' : ''}`}>
                      <div className="flex items-center gap-3">
                        <span className={`w-6 h-6 rounded-full flex items-center justify-center text-xs ${i < 3 ? 'bg-emerald-500/20 text-emerald-400' : i < 6 ? 'bg-yellow-500/20 text-yellow-400' : 'bg-slate-700 text-slate-400'}`}>{i + 1}</span>
                        <span className="text-white">{team?.name}</span>
                      </div>
                      <div className="flex items-center gap-3">
                        <span className="text-slate-300">{parseFloat(score).toFixed(1)}</span>
                        {vpEarned > 0 && <span className={`text-xs ${i < 3 ? 'text-emerald-400' : 'text-yellow-400'}`}>+{vpEarned} VP</span>}
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          </div>
        </div>
      );
    }

    function MatchupBreakdown({ data, standings }) {
      const [selectedMatchup, setSelectedMatchup] = useState(null);
      const [expandedWeek, setExpandedWeek] = useState(null);
      const teams = data.teams;
      
      const h2hData = useMemo(() => {
        const records = {};
        const matchups = {};
        
        teams.forEach(t => {
          records[t.id] = {};
          matchups[t.id] = {};
          teams.forEach(opp => {
            if (t.id !== opp.id) {
              records[t.id][opp.id] = { wins: 0, losses: 0, ties: 0, ptsFor: 0, ptsAgainst: 0 };
              matchups[t.id][opp.id] = [];
            }
          });
        });
        
        data.weeks.forEach(week => {
          const scores = week.scores;
          const rosters = week.rosters || {};
          
          const processMatchup = (home, away, source) => {
            const hs = scores[home] || scores[String(home)] || 0;
            const as = scores[away] || scores[String(away)] || 0;
            
            if (records[home]?.[away]) {
              records[home][away].ptsFor += hs;
              records[home][away].ptsAgainst += as;
              records[away][home].ptsFor += as;
              records[away][home].ptsAgainst += hs;
              
              const matchupDetail = { 
                week: week.week, 
                source, 
                team1: home, 
                team2: away, 
                score1: hs, 
                score2: as,
                roster1: rosters[String(home)]?.players || null,
                roster2: rosters[String(away)]?.players || null
              };
              matchups[home][away].push(matchupDetail);
              matchups[away][home].push({ 
                ...matchupDetail, 
                team1: away, 
                team2: home, 
                score1: as, 
                score2: hs,
                roster1: rosters[String(away)]?.players || null,
                roster2: rosters[String(home)]?.players || null
              });
              
              if (hs > as) { 
                records[home][away].wins++; 
                records[away][home].losses++; 
              } else if (as > hs) { 
                records[away][home].wins++; 
                records[home][away].losses++; 
              } else { 
                records[home][away].ties++; 
                records[away][home].ties++; 
              }
            }
          };
          
          week.espnMatchups?.forEach(([h, a]) => processMatchup(h, a, 'ESPN'));
          const weekSchedule = data.schedule[String(week.week)];
          if (weekSchedule) weekSchedule.forEach(([h, a]) => processMatchup(h, a, 'Schedule'));
        });
        
        return { records, matchups };
      }, [data, teams]);

      const sortedTeams = useMemo(() => {
        return [...teams].sort((a, b) => {
          const aStand = standings.find(s => s.id === a.id);
          const bStand = standings.find(s => s.id === b.id);
          return (bStand?.totalVP || 0) - (aStand?.totalVP || 0);
        });
      }, [teams, standings]);

      const handleCellClick = (team1Id, team2Id) => {
        if (team1Id === team2Id) return;
        if (selectedMatchup?.team1 === team1Id && selectedMatchup?.team2 === team2Id) {
          setSelectedMatchup(null);
          setExpandedWeek(null);
        } else {
          setSelectedMatchup({ team1: team1Id, team2: team2Id });
          setExpandedWeek(null);
        }
      };

      const getTeamById = (id) => teams.find(t => t.id === id);

      return (
        <div className="space-y-4">
          <h3 className="text-lg font-semibold text-white">üìä Head-to-Head Matrix</h3>
          <p className="text-xs text-slate-400">Click any cell to see matchup details with player breakdowns</p>
          
          <div className="overflow-x-auto">
            <table className="w-full text-xs">
              <thead>
                <tr className="border-b border-slate-700">
                  <th className="text-left py-2 px-2 text-slate-400 sticky left-0 bg-slate-900 z-10 min-w-[60px]">Team</th>
                  {sortedTeams.map(t => (
                    <th key={t.id} className="text-center py-2 px-1 text-slate-400 min-w-[48px]" title={t.name}>{t.abbrev}</th>
                  ))}
                  <th className="text-center py-2 px-2 text-slate-400 border-l border-slate-600 min-w-[50px]">Total</th>
                </tr>
              </thead>
              <tbody>
                {sortedTeams.map((team, i) => {
                  const totalW = Object.values(h2hData.records[team.id]).reduce((s, r) => s + r.wins, 0);
                  const totalL = Object.values(h2hData.records[team.id]).reduce((s, r) => s + r.losses, 0);
                  const totalT = Object.values(h2hData.records[team.id]).reduce((s, r) => s + r.ties, 0);
                  return (
                    <tr key={team.id} className={`border-b border-slate-800 ${i < 4 ? 'bg-emerald-500/5' : i < 6 ? 'bg-yellow-500/5' : ''}`}>
                      <td className="py-2 px-2 text-white font-medium sticky left-0 bg-slate-900 z-10">{team.abbrev}</td>
                      {sortedTeams.map(opp => {
                        if (team.id === opp.id) return <td key={opp.id} className="text-center py-2 px-1 text-slate-700">‚Äî</td>;
                        const rec = h2hData.records[team.id][opp.id];
                        const isWinning = rec.wins > rec.losses;
                        const isLosing = rec.losses > rec.wins;
                        const isSelected = selectedMatchup?.team1 === team.id && selectedMatchup?.team2 === opp.id;
                        return (
                          <td 
                            key={opp.id} 
                            onClick={() => handleCellClick(team.id, opp.id)}
                            className={`text-center py-2 px-1 cursor-pointer transition-all rounded
                              ${isWinning ? 'text-emerald-400' : isLosing ? 'text-red-400' : 'text-slate-400'}
                              ${isSelected ? 'bg-blue-500/30 ring-1 ring-blue-400' : 'hover:bg-slate-700/50'}
                            `}
                          >
                            {rec.wins}-{rec.losses}{rec.ties > 0 && `-${rec.ties}`}
                          </td>
                        );
                      })}
                      <td className="text-center py-2 px-2 text-white font-bold border-l border-slate-600">
                        {totalW}-{totalL}{totalT > 0 && `-${totalT}`}
                      </td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
          
          <div className="flex flex-wrap gap-4 text-xs text-slate-500">
            <div className="flex items-center gap-2"><span className="text-emerald-400">‚ñ†</span> Winning record</div>
            <div className="flex items-center gap-2"><span className="text-red-400">‚ñ†</span> Losing record</div>
            <div className="flex items-center gap-2"><span className="text-slate-400">‚ñ†</span> Even record</div>
          </div>

          {selectedMatchup && (
            <div className="mt-6 bg-slate-800/70 rounded-xl p-4 border border-slate-600">
              <div className="flex items-center justify-between mb-4">
                <div className="flex items-center gap-3">
                  <h4 className="text-lg font-semibold text-white">
                    {getTeamById(selectedMatchup.team1)?.name} vs {getTeamById(selectedMatchup.team2)?.name}
                  </h4>
                  <span className={`text-sm px-2 py-1 rounded-full ${
                    h2hData.records[selectedMatchup.team1][selectedMatchup.team2].wins > h2hData.records[selectedMatchup.team1][selectedMatchup.team2].losses 
                      ? 'bg-emerald-500/20 text-emerald-400' 
                      : h2hData.records[selectedMatchup.team1][selectedMatchup.team2].losses > h2hData.records[selectedMatchup.team1][selectedMatchup.team2].wins
                        ? 'bg-red-500/20 text-red-400'
                        : 'bg-slate-700 text-slate-400'
                  }`}>
                    {h2hData.records[selectedMatchup.team1][selectedMatchup.team2].wins}-
                    {h2hData.records[selectedMatchup.team1][selectedMatchup.team2].losses}
                    {h2hData.records[selectedMatchup.team1][selectedMatchup.team2].ties > 0 && 
                      `-${h2hData.records[selectedMatchup.team1][selectedMatchup.team2].ties}`}
                  </span>
                </div>
                <button 
                  onClick={() => { setSelectedMatchup(null); setExpandedWeek(null); }}
                  className="text-slate-400 hover:text-white p-1 rounded hover:bg-slate-700"
                >‚úï</button>
              </div>
              
              <div className="grid grid-cols-2 gap-4 mb-4">
                <div className="bg-slate-900/50 rounded-lg p-3">
                  <div className="text-xs text-slate-400 mb-1">{getTeamById(selectedMatchup.team1)?.abbrev} Total Points</div>
                  <div className="text-xl font-bold text-white">{h2hData.records[selectedMatchup.team1][selectedMatchup.team2].ptsFor.toFixed(1)}</div>
                  <div className="text-xs text-slate-500">Avg: {(h2hData.records[selectedMatchup.team1][selectedMatchup.team2].ptsFor / Math.max(1, h2hData.matchups[selectedMatchup.team1][selectedMatchup.team2].length)).toFixed(1)}/game</div>
                </div>
                <div className="bg-slate-900/50 rounded-lg p-3">
                  <div className="text-xs text-slate-400 mb-1">{getTeamById(selectedMatchup.team2)?.abbrev} Total Points</div>
                  <div className="text-xl font-bold text-white">{h2hData.records[selectedMatchup.team1][selectedMatchup.team2].ptsAgainst.toFixed(1)}</div>
                  <div className="text-xs text-slate-500">Avg: {(h2hData.records[selectedMatchup.team1][selectedMatchup.team2].ptsAgainst / Math.max(1, h2hData.matchups[selectedMatchup.team1][selectedMatchup.team2].length)).toFixed(1)}/game</div>
                </div>
              </div>

              <div className="space-y-3">
                <div className="text-sm font-medium text-slate-300 mb-2">Game-by-Game Results</div>
                {h2hData.matchups[selectedMatchup.team1][selectedMatchup.team2].sort((a, b) => a.week - b.week).map((m, i) => {
                  const team1Won = m.score1 > m.score2;
                  const team2Won = m.score2 > m.score1;
                  const margin = Math.abs(m.score1 - m.score2).toFixed(1);
                  const isExpanded = expandedWeek === `${m.week}-${m.source}`;
                  const hasRosterData = m.roster1 || m.roster2;
                  
                  return (
                    <div key={i} className="bg-slate-900/50 rounded-lg border border-slate-700 overflow-hidden">
                      <div className={`p-3 ${hasRosterData ? 'cursor-pointer hover:bg-slate-800/50' : ''}`} onClick={() => hasRosterData && setExpandedWeek(isExpanded ? null : `${m.week}-${m.source}`)}>
                        <div className="flex items-center justify-between mb-2">
                          <div className="flex items-center gap-2">
                            <span className="text-sm font-medium text-white">Week {m.week}</span>
                            <span className={`text-xs px-2 py-0.5 rounded ${m.source === 'ESPN' ? 'bg-blue-500/20 text-blue-400' : 'bg-purple-500/20 text-purple-400'}`}>{m.source}</span>
                            {hasRosterData && <span className="text-xs text-slate-500">{isExpanded ? '‚ñº' : '‚ñ∂'} Players</span>}
                          </div>
                          <span className={`text-xs ${team1Won ? 'text-emerald-400' : team2Won ? 'text-red-400' : 'text-yellow-400'}`}>
                            {team1Won ? `Won by ${margin}` : team2Won ? `Lost by ${margin}` : 'Tie'}
                          </span>
                        </div>
                        <div className="grid grid-cols-2 gap-4">
                          <div className={`flex items-center justify-between p-2 rounded ${team1Won ? 'bg-emerald-500/10' : ''}`}>
                            <span className={`font-medium ${team1Won ? 'text-emerald-400' : 'text-slate-300'}`}>{getTeamById(selectedMatchup.team1)?.abbrev}</span>
                            <span className={`text-lg font-bold ${team1Won ? 'text-emerald-400' : 'text-white'}`}>{m.score1.toFixed(1)}</span>
                          </div>
                          <div className={`flex items-center justify-between p-2 rounded ${team2Won ? 'bg-emerald-500/10' : ''}`}>
                            <span className={`font-medium ${team2Won ? 'text-emerald-400' : 'text-slate-300'}`}>{getTeamById(selectedMatchup.team2)?.abbrev}</span>
                            <span className={`text-lg font-bold ${team2Won ? 'text-emerald-400' : 'text-white'}`}>{m.score2.toFixed(1)}</span>
                          </div>
                        </div>
                      </div>
                      {isExpanded && hasRosterData && (
                        <div className="border-t border-slate-700 p-3 bg-slate-950/50">
                          <div className="grid md:grid-cols-2 gap-4">
                            <PlayerRoster players={m.roster1} teamName={getTeamById(selectedMatchup.team1)?.name} isWinner={team1Won} />
                            <PlayerRoster players={m.roster2} teamName={getTeamById(selectedMatchup.team2)?.name} isWinner={team2Won} />
                          </div>
                        </div>
                      )}
                    </div>
                  );
                })}
              </div>
              {h2hData.matchups[selectedMatchup.team1][selectedMatchup.team2].length === 0 && (
                <div className="text-center py-8 text-slate-400">No matchups played between these teams yet</div>
              )}
            </div>
          )}
        </div>
      );
    }

    function PlayoffMatchup({ title, team1Seed, team2Seed, week1Score, week2Score, winner, seeds, isTwoWeek, weekLabel, rosters, week1, week2 }) {
      const [isExpanded, setIsExpanded] = useState(false);
      if (!team1Seed || !team2Seed) return null;
      
      const t1 = seeds[team1Seed]; 
      const t2 = seeds[team2Seed];
      const t1w1 = week1Score?.[String(team1Seed)]; 
      const t1w2 = week2Score?.[String(team1Seed)];
      const t2w1 = week1Score?.[String(team2Seed)]; 
      const t2w2 = week2Score?.[String(team2Seed)];
      const t1Total = (t1w1 || 0) + (t1w2 || 0); 
      const t2Total = (t2w1 || 0) + (t2w2 || 0);
      const hasScores = t1w1 !== null && t1w1 !== undefined;
      
      const week1Rosters = rosters?.[week1] || {};
      const week2Rosters = rosters?.[week2] || {};
      const t1Roster1 = week1Rosters[String(t1?.id)]?.players;
      const t2Roster1 = week1Rosters[String(t2?.id)]?.players;
      const t1Roster2 = week2Rosters[String(t1?.id)]?.players;
      const t2Roster2 = week2Rosters[String(t2?.id)]?.players;
      const hasRosterData = t1Roster1 || t2Roster1 || t1Roster2 || t2Roster2;
      
      return (
        <div className="bg-slate-900/50 rounded-lg overflow-hidden">
          <div className={`p-3 ${hasRosterData ? 'cursor-pointer hover:bg-slate-800/50' : ''}`} onClick={() => hasRosterData && setIsExpanded(!isExpanded)}>
            <div className="flex items-center justify-between mb-2">
              <div className="text-xs text-emerald-400">{title}</div>
              {hasRosterData && <span className="text-xs text-slate-500">{isExpanded ? '‚ñº' : '‚ñ∂'} Players</span>}
            </div>
            {weekLabel && <div className="text-xs text-slate-500 mb-2">{weekLabel}</div>}
            <div className={`flex justify-between py-2 border-b border-slate-700 ${winner === team1Seed ? 'text-emerald-400' : 'text-white'}`}>
              <span>({team1Seed}) {t1?.abbrev || t1?.name}</span>
              <div className="flex gap-2">
                {hasScores && <span className="text-slate-400">{t1w1?.toFixed(1)}{isTwoWeek && t1w2 !== null && t1w2 !== undefined && ` + ${t1w2?.toFixed(1)}`}</span>}
                {isTwoWeek && hasScores && t1w2 !== null && <span className="font-bold">= {t1Total.toFixed(1)}</span>}
                {!isTwoWeek && hasScores && <span className="font-bold">{t1w1?.toFixed(1)}</span>}
              </div>
            </div>
            <div className={`flex justify-between py-2 ${winner === team2Seed ? 'text-emerald-400' : 'text-white'}`}>
              <span>({team2Seed}) {t2?.abbrev || t2?.name}</span>
              <div className="flex gap-2">
                {hasScores && <span className="text-slate-400">{t2w1?.toFixed(1)}{isTwoWeek && t2w2 !== null && t2w2 !== undefined && ` + ${t2w2?.toFixed(1)}`}</span>}
                {isTwoWeek && hasScores && t2w2 !== null && <span className="font-bold">= {t2Total.toFixed(1)}</span>}
                {!isTwoWeek && hasScores && <span className="font-bold">{t2w1?.toFixed(1)}</span>}
              </div>
            </div>
          </div>
          
          {isExpanded && hasRosterData && (
            <div className="border-t border-slate-700 p-3 bg-slate-950/50 space-y-4">
              {(t1Roster1 || t2Roster1) && (
                <div>
                  <div className="text-xs text-slate-400 mb-2 font-medium">Week {week1}</div>
                  <div className="grid md:grid-cols-2 gap-4">
                    <PlayerRoster players={t1Roster1} teamName={t1?.name} isWinner={t1w1 > t2w1} />
                    <PlayerRoster players={t2Roster1} teamName={t2?.name} isWinner={t2w1 > t1w1} />
                  </div>
                </div>
              )}
              {isTwoWeek && (t1Roster2 || t2Roster2) && (
                <div className="border-t border-slate-700 pt-4">
                  <div className="text-xs text-slate-400 mb-2 font-medium">Week {week2}</div>
                  <div className="grid md:grid-cols-2 gap-4">
                    <PlayerRoster players={t1Roster2} teamName={t1?.name} isWinner={t1w2 > t2w2} />
                    <PlayerRoster players={t2Roster2} teamName={t2?.name} isWinner={t2w2 > t1w2} />
                  </div>
                </div>
              )}
            </div>
          )}
        </div>
      );
    }

    function Playoffs({ projections, playoffData, playoffWeeks }) {
      if (!playoffData) return <div className="text-slate-400 text-center py-8">Playoff data not available yet</div>;
      const { seeds, championship, consolation: cons } = playoffData;
      const hasPlayoffData = championship?.semifinal1?.week14Score;
      
      const rosters = {};
      playoffWeeks?.forEach(w => { if (w.rosters) rosters[w.week] = w.rosters; });
      
      return (
        <div className="space-y-6">
          <div className="grid md:grid-cols-2 gap-6">
            <div>
              <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">üèÜ Championship Bracket</h3>
              <div className="space-y-4">
                <PlayoffMatchup title="Semifinal 1 (Wk 14-15)" team1Seed={1} team2Seed={4} week1Score={championship?.semifinal1?.week14Score} week2Score={championship?.semifinal1?.week15Score} winner={championship?.semifinal1?.winner} seeds={seeds} isTwoWeek={true} rosters={rosters} week1={14} week2={15} />
                <PlayoffMatchup title="Semifinal 2 (Wk 14-15)" team1Seed={2} team2Seed={3} week1Score={championship?.semifinal2?.week14Score} week2Score={championship?.semifinal2?.week15Score} winner={championship?.semifinal2?.winner} seeds={seeds} isTwoWeek={true} rosters={rosters} week1={14} week2={15} />
                {championship?.final?.team1Seed && (
                  <div className="border-t border-slate-700 pt-4">
                    <PlayoffMatchup title="üèÜ Championship (Wk 16-17)" team1Seed={championship.final.team1Seed} team2Seed={championship.final.team2Seed} week1Score={championship.final.week16Score} week2Score={championship.final.week17Score} winner={championship.final.winner} seeds={seeds} isTwoWeek={true} rosters={rosters} week1={16} week2={17} />
                  </div>
                )}
                {championship?.final?.winner && (
                  <div className="mt-4 text-center">
                    <div className="inline-block bg-gradient-to-r from-yellow-500/20 via-emerald-500/20 to-blue-500/20 rounded-lg px-6 py-4 border border-yellow-500/30">
                      <div className="text-yellow-400 text-sm font-bold">üèÜ LEAGUE CHAMPION üèÜ</div>
                      <div className="text-white text-xl mt-1 font-bold">{seeds[championship.final.winner]?.name}</div>
                    </div>
                  </div>
                )}
              </div>
            </div>

            <div>
              <h3 className="text-lg font-semibold text-white mb-4">üéñÔ∏è Consolation Bracket</h3>
              <div className="space-y-4">
                {hasPlayoffData && cons?.week14 ? (
                  <>
                    <div className="grid grid-cols-2 gap-2">
                      <div className="bg-slate-900/50 rounded-lg p-3 border border-slate-700"><div className="text-xs text-slate-400 mb-1">5 Seed (Bye)</div><div className="text-white">{seeds[5]?.abbrev}</div></div>
                      <div className="bg-slate-900/50 rounded-lg p-3 border border-slate-700"><div className="text-xs text-slate-400 mb-1">6 Seed (Bye)</div><div className="text-white">{seeds[6]?.abbrev}</div></div>
                    </div>
                    <PlayoffMatchup title="7 vs 10 (Wk 14)" team1Seed={7} team2Seed={10} week1Score={cons.week14.match1.score} winner={cons.week14.match1.winner} seeds={seeds} isTwoWeek={false} rosters={rosters} week1={14} />
                    <PlayoffMatchup title="8 vs 9 (Wk 14)" team1Seed={8} team2Seed={9} week1Score={cons.week14.match2.score} winner={cons.week14.match2.winner} seeds={seeds} isTwoWeek={false} rosters={rosters} week1={14} />
                  </>
                ) : (
                  <>
                    <div className="grid grid-cols-2 gap-2">
                      <div className="bg-slate-900/50 rounded-lg p-3 border border-slate-700"><div className="text-xs text-slate-400 mb-1">5 Seed (Bye)</div><div className="text-white">{seeds[5]?.abbrev}</div></div>
                      <div className="bg-slate-900/50 rounded-lg p-3 border border-slate-700"><div className="text-xs text-slate-400 mb-1">6 Seed (Bye)</div><div className="text-white">{seeds[6]?.abbrev}</div></div>
                    </div>
                    <div className="bg-slate-900/50 rounded-lg p-3 border border-slate-700"><div className="text-xs text-slate-400">Wk 14: 7 vs 10</div><div className="text-slate-300 text-sm">Winner advances</div></div>
                    <div className="bg-slate-900/50 rounded-lg p-3 border border-slate-700"><div className="text-xs text-slate-400">Wk 14: 8 vs 9</div><div className="text-slate-300 text-sm">Winner advances</div></div>
                  </>
                )}
                {hasPlayoffData && cons?.week15 ? (
                  <div className="border-t border-slate-700 pt-4 space-y-2">
                    <PlayoffMatchup title="5 vs Wk14 Winner (Wk 15)" team1Seed={cons.week15.match1.team1Seed} team2Seed={cons.week15.match1.team2Seed} week1Score={cons.week15.match1.score} winner={cons.week15.match1.winner} seeds={seeds} isTwoWeek={false} rosters={rosters} week1={15} />
                    <PlayoffMatchup title="6 vs Wk14 Winner (Wk 15)" team1Seed={cons.week15.match2.team1Seed} team2Seed={cons.week15.match2.team2Seed} week1Score={cons.week15.match2.score} winner={cons.week15.match2.winner} seeds={seeds} isTwoWeek={false} rosters={rosters} week1={15} />
                  </div>
                ) : (<div className="border-t border-slate-700 pt-4 text-slate-400 text-sm">Week 15 matchups TBD</div>)}
                {hasPlayoffData && cons?.final?.team1Seed ? (
                  <div className="border-t border-slate-700 pt-4">
                    <PlayoffMatchup title="üéñÔ∏è Consolation Final (Wk 16-17)" team1Seed={cons.final.team1Seed} team2Seed={cons.final.team2Seed} week1Score={cons.final.week16Score} week2Score={cons.final.week17Score} winner={cons.final.winner} seeds={seeds} isTwoWeek={true} rosters={rosters} week1={16} week2={17} />
                    {cons.final.winner && (<div className="mt-2 text-center"><div className="inline-block bg-yellow-500/20 rounded-lg px-4 py-2"><div className="text-yellow-400 text-sm font-bold">üéñÔ∏è CONSOLATION WINNER</div><div className="text-white text-lg mt-1">{seeds[cons.final.winner]?.name}</div></div></div>)}
                  </div>
                ) : (<div className="bg-slate-900/50 rounded-lg p-3 border border-yellow-500/30"><div className="text-xs text-yellow-400">üéñÔ∏è Consolation Final (Wk 16-17)</div><div className="text-slate-300 text-sm">Week 15 winners ‚Ä¢ 2-week total</div></div>)}
                
                {hasPlayoffData && cons && cons.toiletBowl.team1Seed && cons.toiletBowl.team2Seed ? (
                  <div>
                    <PlayoffMatchup title="üíÄ Toilet Bowl (Weeks 15-16)" team1Seed={cons.toiletBowl.team1Seed} team2Seed={cons.toiletBowl.team2Seed} week1Score={cons.toiletBowl.week15Score} week2Score={cons.toiletBowl.week16Score} winner={cons.toiletBowl.loser === cons.toiletBowl.team1Seed ? cons.toiletBowl.team2Seed : cons.toiletBowl.team1Seed} seeds={seeds} isTwoWeek={true} weekLabel="Loser 'wins' üöΩ" rosters={rosters} week1={15} week2={16} />
                    {cons.toiletBowl.loser && (<div className="mt-2 text-center"><div className="inline-block bg-red-500/30 rounded-lg px-4 py-2"><div className="text-red-400 text-sm font-bold">üíÄ TOILET BOWL WINNER üíÄ</div><div className="text-white text-lg mt-1">{seeds[cons.toiletBowl.loser]?.name}</div></div></div>)}
                  </div>
                ) : (<div className="bg-slate-900/50 rounded-lg p-3 border border-red-500/30"><div className="text-xs text-red-400">üíÄ Toilet Bowl (Wk 15-16)</div><div className="text-slate-300 text-sm">Week 14 losers ‚Ä¢ Loser "wins" üöΩ</div></div>)}
              </div>
            </div>
          </div>

          <div>
            <h3 className="text-lg font-semibold text-white mb-4">üìä Final Standings</h3>
            <div className="bg-slate-800/50 rounded-lg border border-slate-700 overflow-hidden">
              <table className="w-full text-sm">
                <thead className="bg-slate-800"><tr className="text-slate-400"><th className="text-left py-2 px-3">Seed</th><th className="text-left py-2 px-3">Team</th><th className="text-center py-2 px-3">VP</th><th className="text-center py-2 px-3">Total Pts</th><th className="text-center py-2 px-3">Bracket</th></tr></thead>
                <tbody>
                  {projections.map((team, i) => (
                    <tr key={team.id} className="border-t border-slate-700">
                      <td className="py-2 px-3 text-slate-400">{i + 1}</td><td className="py-2 px-3 text-white">{team.name}</td>
                      <td className="text-center py-2 px-3 text-slate-300">{team.totalVP}</td><td className="text-center py-2 px-3 text-slate-400">{team.totalPts?.toFixed(1)}</td>
                      <td className="text-center py-2 px-3"><span className={`text-xs px-2 py-1 rounded-full ${i < 4 ? 'bg-emerald-500/20 text-emerald-400' : i < 6 ? 'bg-yellow-500/20 text-yellow-400' : 'bg-slate-700 text-slate-400'}`}>{i < 4 ? 'Championship' : i < 6 ? 'Consolation (Bye)' : 'Consolation'}</span></td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      );
    }

    function App() {
      const [data, setData] = useState(null);
      const [loading, setLoading] = useState(true);
      const [view, setView] = useState('standings');
      const [selectedWeek, setSelectedWeek] = useState(1);

      useEffect(() => {
        fetch('data.json')
          .then(res => res.json())
          .then(d => { setData(d); setSelectedWeek(d.weeks.length); setLoading(false); })
          .catch(err => { console.error(err); setLoading(false); });
      }, []);

      const standings = useMemo(() => {
        if (!data) return [];
        if (data.standings) return data.standings;
        return calculateStandings(data.teams, data.weeks, data.schedule);
      }, [data]);
      const projections = useMemo(() => {
        if (!data || !standings.length) return [];
        return calculateProjections(standings, data.weeks.length, CONFIG.regularSeasonWeeks);
      }, [standings, data]);

      if (loading) return <div className="min-h-screen bg-slate-900 text-white flex items-center justify-center">Loading...</div>;
      if (!data) return <div className="min-h-screen bg-slate-900 text-white flex items-center justify-center">Failed to load data.json</div>;

      const tabs = [
        { id: 'standings', label: 'Standings' }, 
        { id: 'matchups', label: 'Matchups' }, 
        { id: 'h2h', label: 'H2H' },
        { id: 'playoffs', label: 'Playoffs' }
      ];

      return (
        <div className="min-h-screen bg-slate-900 text-white p-3 md:p-6">
          <div className="max-w-4xl mx-auto">
            <div className="text-center mb-6">
              <h1 className="text-2xl md:text-3xl font-bold bg-gradient-to-r from-yellow-400 via-emerald-400 to-blue-500 bg-clip-text text-transparent">{data.leagueName}</h1>
              <p className="text-slate-400 mt-1">{data.year} Season ‚Ä¢ Week {data.currentWeek || data.weeks.length}</p>
            </div>
            <div className="flex gap-1 mb-6 bg-slate-800 p-1 rounded-lg">
              {tabs.map(tab => (<button key={tab.id} onClick={() => setView(tab.id)} className={`flex-1 py-2 px-3 rounded-md text-sm font-medium ${view === tab.id ? 'bg-slate-700 text-white' : 'text-slate-400 hover:text-white'}`}>{tab.label}</button>))}
            </div>
            <div className="bg-slate-800/30 rounded-xl p-4 md:p-6 border border-slate-700">
              {view === 'standings' && <Standings projections={projections} />}
              {view === 'matchups' && <WeeklyView data={data} standings={standings} selectedWeek={selectedWeek} setSelectedWeek={setSelectedWeek} />}
              {view === 'h2h' && <MatchupBreakdown data={data} standings={standings} />}
              {view === 'playoffs' && <Playoffs projections={projections} playoffData={data.playoffs} playoffWeeks={data.playoffWeeks} />}
            </div>
            <div className="text-center mt-6 text-xs text-slate-600">Last updated: {new Date().toLocaleDateString()}</div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
